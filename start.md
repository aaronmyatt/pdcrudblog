# Start
Any pipe can be executed as a server. However, you will want to create an "entry" pipe that delegates the request to other pipes, much a like a route file in a traditional framework.

## Index Page
We will use a [blog template](https://github.com/davidgrzyb/tailwind-blog-template/tree/master) to make our lives easier!

- route: /
- ```ts
    const page = await Deno.readTextFile('./html/index.html')
    input.body = page;
    input.responseOptions.headers['content-type'] = 'text/html; charset=utf-8'
    ```

## Post page
This post template is also from the [blog template](https://github.com/davidgrzyb/tailwind-blog-template/tree/master)

- route: /post/*
- ```ts
    const page = await Deno.readTextFile('./html/post.html')
    input.body = page;
    input.responseOptions.headers['content-type'] = 'text/html; charset=utf-8'
    ```

## Form
This is just a [form component from TailwindUI](https://tailwindui.com/components/application-ui/forms/form-layouts) wrapped in the blog layout, take a look inside: [[formPage]]

- route: /form/*
- ```ts
    import formPage from 'formPage'
    const output = await formPage.process();
    input.body = output.layout;
    input.responseOptions.headers['content-type'] = 'text/html; charset=utf-8'
    ```

## API CrUD
Pass requests to [[postStore]] mapping the request path to the CRUD action.

`const action = $p.get(input, '/route/pathname/groups/action')`
`const output = await postStore.process({post: {[action]: input.payload}})`

- route: /api/:action(create|update|delete)
- ```ts
    import postStore from 'postStore'

    input.payload = {};
    const action = $p.get(input, '/route/pathname/groups/action')

    try {
        const formData = await input.request.formData()
        input.payload =  {
            title: formData.get('title'),
            body: formData.get('body'),
            slug: formData.get('slug'),
        }
        const url = new URL(input.request.url)
        input.response = Response.redirect(url.origin)
    } catch(e) {
        // not form data
    } finally {
        const output = await postStore.process({post: {[action]: input.payload}})
        console.log(input);
        console.log(output);
        input.body = $p.get(output, '/posts') || $p.get(output, '/post')
    }
    ```

## APIRead
Pass requests to [[postStore]] mapping the request path to the CRUD action.

- route: /api/:action(list|read)
- ```ts
    const action = $p.get(input, '/route/pathname/groups/action')

    if(action === 'list'){
        const output = await postStore.process({post: {list: {}}})
        input.body = output.posts
    }
    if(action === 'read'){
        const {slug} = await input.request.json()
        const output = await postStore.process({post: {read: {slug}}})
        input.body = output.post;
        console.log(input);
    }
    ```

[//begin]: # "Autogenerated link references for markdown compatibility"
[formPage]: formPage.md "FormPage"
[postStore]: postStore.md "postStore"
[//end]: # "Autogenerated link references"